<Window x:Class="Socks5Client.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:Socks5Client.UI.Converters"
        mc:Ignorable="d"
        Title="SOCKS5/HTTP 代理客户端" Height="600" Width="950"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <converters:BoolToConnectedConverter x:Key="BoolToConnectedConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200" MinHeight="150" MaxHeight="400">
                <RowDefinition.Style>
                    <Style TargetType="RowDefinition">
                        <Setter Property="Height" Value="0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ShowLogs}" Value="True">
                                <Setter Property="Height" Value="200"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </RowDefinition.Style>
            </RowDefinition>
        </Grid.RowDefinitions>

        <!-- 顶部工具栏 -->
        <Grid Grid.Row="0" Background="#F0F0F0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10">
                <Button Content="添加节点" Command="{Binding AddNodeCommand}" Margin="5" Padding="10,5"/>
                <Button Content="编辑节点" Command="{Binding EditNodeCommand}" Margin="5" Padding="10,5"/>
                <Button Content="删除节点" Command="{Binding DeleteNodeCommand}" Margin="5" Padding="10,5"/>
                <Separator Margin="10,0"/>
                <Button Content="测试延迟" Command="{Binding TestLatencyCommand}" Margin="5" Padding="10,5"/>
                <Button Content="测试全部" Command="{Binding TestAllNodesCommand}" Margin="5" Padding="10,5"/>
            </StackPanel>
            <Button Grid.Column="1" Content="关于" Margin="5" Padding="10,5" Click="AboutButton_Click"/>
        </Grid>

        <!-- 主要内容区 -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧：节点列表 -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="代理节点列表" FontSize="14" FontWeight="Bold" Margin="5"/>
                <ListView Grid.Row="1" ItemsSource="{Binding ProxyNodes}" SelectedItem="{Binding SelectedNode}" 
                         SelectionMode="Single" Margin="5">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="名称" Width="120" DisplayMemberBinding="{Binding Name}"/>
                            <GridViewColumn Header="类型" Width="80" DisplayMemberBinding="{Binding Type}"/>
                            <GridViewColumn Header="服务器" Width="130" DisplayMemberBinding="{Binding Server}"/>
                            <GridViewColumn Header="端口" Width="70" DisplayMemberBinding="{Binding Port}"/>
                            <GridViewColumn Header="延迟" Width="80" DisplayMemberBinding="{Binding LatencyDisplay}"/>
                            <GridViewColumn Header="状态" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding IsConnected, Converter={StaticResource BoolToConnectedConverter}}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>

            <!-- 右侧：状态信息 -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="LightGray"/>
            
            <Grid Grid.Column="2" Margin="10,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="连接状态" FontSize="14" FontWeight="Bold" Margin="5"/>
                
                <StackPanel Grid.Row="1" Margin="5">
                    <TextBlock Text="当前状态:" Margin="0,10,0,5"/>
                    <TextBlock Text="{Binding StatusMessage}" FontSize="16" FontWeight="Bold" 
                              Foreground="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"/>
                    
                    <TextBlock Text="当前节点:" Margin="0,20,0,5"/>
                    <TextBlock Text="{Binding SelectedNode.Name, FallbackValue='未选择'}" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="上传流量:" Margin="0,10,0,5"/>
                    <TextBlock Text="{Binding UploadSpeedDisplay}" FontSize="12" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="下载流量:" Margin="0,10,0,5"/>
                    <TextBlock Text="{Binding DownloadSpeedDisplay}" FontSize="12" Margin="0,0,0,10"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="5">
                    <Button Content="连接" Command="{Binding ConnectCommand}" Margin="5" Padding="20,5" 
                           IsEnabled="{Binding IsConnected, Converter={StaticResource InverseBoolConverter}}"/>
                    <Button Content="断开" Command="{Binding DisconnectCommand}" Margin="5" Padding="20,5" 
                           IsEnabled="{Binding IsConnected}"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- 底部状态栏 -->
        <StatusBar Grid.Row="2" Background="#F0F0F0">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <Button Content="显示日志" Click="ToggleLogsButton_Click" Padding="10,2" Margin="5,0"/>
            </StatusBarItem>
        </StatusBar>

        <!-- 日志面板分隔线 -->
        <GridSplitter Grid.Row="3" HorizontalAlignment="Stretch" Background="LightGray" Height="3" 
                     ResizeDirection="Rows" ResizeBehavior="PreviousAndNext"
                     Visibility="{Binding ShowLogs, Converter={StaticResource BoolToVisibilityConverter}}"/>

        <!-- 日志显示区域 -->
        <Grid Grid.Row="4" Visibility="{Binding ShowLogs, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <Grid Grid.Row="0" Background="#E0E0E0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="日志" FontSize="14" FontWeight="Bold" Margin="10,5"/>
                <Button Grid.Column="1" Content="清除" Click="ClearLogsButton_Click" Margin="5" Padding="10,2"/>
            </Grid>
            
            <ListBox Grid.Row="1" ItemsSource="{Binding LogEntries}" 
                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                    FontFamily="Consolas" FontSize="11">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="5,2">
                            <TextBlock Text="{Binding Timestamp, StringFormat='[{0:HH:mm:ss}]'}" 
                                      Foreground="Gray" Width="80"/>
                            <TextBlock Text="{Binding Level}" Width="80" Margin="5,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="Blue"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                                <Setter Property="Foreground" Value="Orange"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                                <Setter Property="Foreground" Value="Red"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Level}" Value="Debug">
                                                <Setter Property="Foreground" Value="Gray"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap" Margin="5,0"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </Grid>
</Window>

